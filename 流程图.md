flowchart TD
    A[用户安装插件] --> B[插件自动获取浏览器唯一用户ID<br>（无需用户操作，后台完成）]
    B --> C[进入插件主界面<br>默认显示“基础版”]
    
    %% 基础版流程（免费，无门槛）
    C --> D[选择“基础版”]
    D --> E[判断当前页面类型]
    E -->|A页面| F[显示“基础版A按钮”]
    E -->|B页面| G[显示“基础版B按钮”]
    F --> H[用户点击按钮完成当前章节操作]
    G --> H
    H --> I{当前章节是否完成？}
    I -->|是| J[提示“请手动切换到下一章”]
    J --> E
    I -->|否| H
    
    %% Pro版流程（需API-Key激活）
    C --> K[选择“Pro版”]
    K --> L{插件内是否已输入有效API-Key？}
    L -->|是| M[验证API-Key与浏览器用户ID是否绑定<br>（后端校验）]
    M -->|绑定成功| N[显示“Pro一键完成按钮”]
    N --> O[用户点击按钮<br>自动完成所有章节操作]
    O --> P[提示“所有章节已完成”]
    M -->|绑定失败（如发给他人）| Q[提示“API-Key与当前设备不匹配，请使用本人授权Key”]
    Q --> R[跳转至“API-Key输入页”]
    L -->|否| R
    R --> S[用户点击“获取API-Key”按钮]
    S --> T[显示你的微信收款二维码<br>标注“请支付对应套餐费用后，截图发此微信”]
    T --> U[用户完成支付→截图→发送至你微信]
    U --> V[你验证支付截图→在后端绑定“用户浏览器ID+API-Key”→将API-Key发给用户]
    V --> W[用户在插件内输入API-Key并提交]
    W --> M
    
    %% 做题版流程（需单独API-Key或全能API-Key激活）
    C --> X[选择“做题版”]
    X --> Y{插件内是否已输入有效做题版API-Key？}
    Y -->|是| Z[验证API-Key与浏览器用户ID绑定关系<br>（后端校验）]
    Z -->|绑定成功| AA[进入做题界面<br>显示题目/选项/提交按钮/数据分析功能]
    AA --> AB[用户做题→提交→查看正确率/错题本]
    Z -->|绑定失败| Q
    Y -->|否| AC[显示做题版套餐价格+你的微信收款二维码<br>标注“支付后截图发微信，获取做题版API-Key”]
    AC --> AD[用户支付→截图→你验证→发送做题版API-Key]
    AD --> AE[用户输入API-Key并提交]
    AE --> Z